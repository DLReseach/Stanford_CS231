![](media/image1.jpeg){width="9.73125in" height="1.9243055555555555in"}

Recurrent Neural Networks

![](media/image2.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 1 8 Feb 2016

> ![](media/image3.jpeg){width="9.7625in" height="4.167361111111111in"}

-   Midterm this Wednesday! woohoo!

-   A3 will be out \~Wednesday

![](media/image4.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 2 8 Feb 2016

![](media/image5.jpeg){width="9.888194444444444in"
height="5.573611111111111in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 3        | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

> ![](media/image6.jpeg){width="8.86736111111111in"
> height="0.3611111111111111in"}

![](media/image7.jpeg){width="10.0in" height="5.084027777777778in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 4 8 Feb 2016

> ![](media/image8.jpeg){width="8.86736111111111in"
> height="0.3611111111111111in"}

![](media/image9.jpeg){width="10.0in" height="5.129166666666666in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 5 8 Feb 2016

> ![](media/image10.jpeg){width="9.060416666666667in"
> height="0.7479166666666667in"}

![](media/image11.jpeg){width="9.590277777777779in"
height="3.220138888888889in"}

> ![](media/image12.jpeg){width="0.6819444444444445in"
> height="0.5194444444444445in"} **Vanilla Neural Networks**

![](media/image13.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 6 8 Feb 2016

![](media/image15.jpeg){width="9.060416666666667in"
height="0.7479166666666667in"}

> Recurrent Networks offer a lot of flexibility:

![](media/image16.jpeg){width="9.590277777777779in"
height="3.2680555555555557in"}

> ![](media/image17.jpeg){width="0.40347222222222223in"
> height="0.47638888888888886in"} e.g. **Image Captioning**

![](media/image18.jpeg){width="3.6354166666666665in"
height="0.5388888888888889in"}

> image -\> sequence of words

![](media/image19.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 7        | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image20.jpeg){width="9.060416666666667in"
height="0.7479166666666667in"}

> Recurrent Networks offer a lot of flexibility:

![](media/image21.jpeg){width="9.590277777777779in"
height="3.6909722222222223in"}

> e.g. **Sentiment Classification**
>
> sequence of words -\> sentiment

![](media/image22.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 8        | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image23.jpeg){width="9.060416666666667in"
height="0.7479166666666667in"}

> Recurrent Networks offer a lot of flexibility:

![](media/image24.jpeg){width="9.79513888888889in"
height="3.6770833333333335in"}

> e.g. **Machine Translation**
>
> seq of words -\> seq of words

![](media/image25.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 9        | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image26.jpeg){width="9.060416666666667in"
height="0.7479166666666667in"}

> Recurrent Networks offer a lot of flexibility:

![](media/image27.jpeg){width="9.590277777777779in"
height="3.957638888888889in"}

> e.g. **Video classification on frame level**

![](media/image28.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 10       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

> ![](media/image29.jpeg){width="7.16875in"
> height="4.420833333333333in"}
>
> Processing
>
> of fixed
>
> inputs

![](media/image30.jpeg){width="4.033333333333333in"
height="0.4666666666666667in"}

> Multiple Object Recognition with Visual Attention, Ba et al.

![](media/image31.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 11 8 Feb 2016

> ![](media/image32.jpeg){width="8.25763888888889in"
> height="4.688888888888889in"}
>
> DRAW: A Recurrent Neural Network For Image Generation, Gregor et al.

![](media/image33.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 12 8 Feb 2016

![](media/image34.jpeg){width="7.996527777777778in"
height="0.45902777777777776in"}

![](media/image35.jpeg){width="1.7638888888888888in"
height="2.1479166666666667in"}

RNN

![](media/image36.jpeg){width="5.208880139982502e-3in"
height="0.40555555555555556in"}

x

![](media/image37.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 13 8 Feb 2016

![](media/image38.jpeg){width="7.996527777777778in"
height="0.45902777777777776in"}

![](media/image39.jpeg){width="4.732638888888889in"
height="3.7444444444444445in"}

> y

![](media/image40.jpeg){width="5.208880139982502e-3in"
height="0.38680555555555557in"}

> RNN

![](media/image41.jpeg){width="5.208880139982502e-3in"
height="0.40555555555555556in"}

> x

![](media/image42.jpeg){width="10.0in" height="0.5888888888888889in"}

usually want to predict a vector at some time steps

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 14 8 Feb 2016

![](media/image43.jpeg){width="7.996527777777778in"
height="0.45902777777777776in"}

![](media/image44.jpeg){width="9.565972222222221in"
height="3.5708333333333333in"}

> We can process a sequence of vectors **x** by applying a recurrence
> formula at every time step:
>
> new state old state input vector at
>
> some time step
>
> some function
>
> with parameters W

![](media/image45.jpeg){width="10.0in" height="0.5888888888888889in"}

> y

![](media/image46.jpeg){width="5.208880139982502e-3in"
height="0.38680555555555557in"}

RNN

![](media/image47.jpeg){width="5.208880139982502e-3in"
height="0.40555555555555556in"}

> x

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 15 8 Feb 2016

![](media/image48.jpeg){width="7.996527777777778in"
height="0.45902777777777776in"}

![](media/image49.jpeg){width="9.565972222222221in"
height="3.5708333333333333in"}

+---------------------------------------------------+-----+--+
| We can process a sequence of vectors **x** by     | > y |  |
+---------------------------------------------------+-----+--+
| applying a recurrence formula at every time step: |     |  |
+---------------------------------------------------+-----+--+

![](media/image50.jpeg){width="5.208880139982502e-3in"
height="0.38680555555555557in"}

RNN

![](media/image53.jpeg){width="5.208880139982502e-3in"
height="0.40555555555555556in"}

> Notice: the same function and the same set of parameters are used at
> every time step.

![](media/image55.jpeg){width="10.0in" height="0.5888888888888889in"}

x

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 16 8 Feb 2016

> (Vanilla) Recurrent Neural Network

![](media/image56.jpeg){width="6.847916666666666in"
height="0.5756944444444444in"}

> The state consists of a single *"hidden"* vector **h**:

![](media/image57.jpeg){width="1.675in" height="3.3493055555555555in"}

> y

![](media/image59.jpeg){width="5.208880139982502e-3in"
height="0.36666666666666664in"}

> RNN

![](media/image62.jpeg){width="5.208880139982502e-3in"
height="0.38472222222222224in"}

> x

![](media/image65.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 17 8 Feb 2016

> ![](media/image66.jpeg){width="3.051388888888889in"
> height="3.2083333333333335in"}
>
> **language model**

![](media/image68.jpeg){width="5.208880139982502e-3in"
height="0.2861111111111111in"}

> **example**

![](media/image69.jpeg){width="5.208880139982502e-3in" height="0.3in"}

> Vocabulary:
>
> \[h,e,l,o\]
>
> Example training
>
> sequence:
>
> **"hello"**

![](media/image70.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 18 8 Feb 2016

> ![](media/image71.jpeg){width="9.622222222222222in"
> height="4.659722222222222in"}
>
> Vocabulary:
>
> \[h,e,l,o\]
>
> Example training sequence:
>
> **"hello"**

![](media/image72.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 19 8 Feb 2016

> ![](media/image73.jpeg){width="9.622222222222222in"
> height="4.659722222222222in"}
>
> Vocabulary:
>
> \[h,e,l,o\]
>
> Example training sequence:
>
> **"hello"**

![](media/image74.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 20 8 Feb 2016

> ![](media/image75.jpeg){width="9.558333333333334in"
> height="4.652083333333334in"}
>
> Vocabulary:
>
> \[h,e,l,o\]
>
> Example training sequence:
>
> **"hello"**

![](media/image76.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 21 8 Feb 2016

![](media/image77.jpeg){width="10.0in" height="4.810416666666667in"}

> [**min-char-rnn.py**](https://gist.github.com/karpathy/d4dee566867f8291f086)![](media/image78.jpeg){width="9.722222222222222e-2in"
> height="0.31527777777777777in"}[**gist: 112 lines of
> Python**](https://gist.github.com/karpathy/d4dee566867f8291f086)
>
> ([[https://gist.github.]{.underline}](https://gist.github.com/karpathy/d4dee566867f8291f086)
>
> [[com/karpathy/d4dee566867f8291f086]{.underline}](https://gist.github.com/karpathy/d4dee566867f8291f086))

![](media/image79.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 22       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image80.jpeg){width="9.180555555555555in"
height="5.577083333333333in"}

Data I/O

![](media/image81.jpeg){width="6.466666666666667in"
height="2.4277777777777776in"}

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image83.jpeg){width="8.321527777777778in"
height="5.5784722222222225in"}

Initializations

![](media/image84.jpeg){width="6.436111111111111in"
height="4.968055555555556in"}

> recall:

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image86.jpeg){width="9.464583333333334in" height="5.6125in"}

Main loop

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image87.jpeg){width="9.580555555555556in" height="5.6125in"}

Main loop

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image88.jpeg){width="9.580555555555556in" height="5.6125in"}

Main loop

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image89.jpeg){width="9.580555555555556in" height="5.6125in"}

Main loop

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image90.jpeg){width="9.580555555555556in" height="5.6125in"}

Main loop

[**min-char-rnn.py**
gist](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image91.jpeg){width="9.730555555555556in"
height="5.5784722222222225in"}

> Loss function

-   forward pass (compute loss)

-   backward pass (compute param gradient)

![](media/image92.jpeg){width="5.302777777777778in"
height="4.370833333333334in"}

[**min-char-rnn.py**](https://gist.github.com/karpathy/d4dee566867f8291f086)![](media/image94.jpeg){width="8.194444444444444e-2in"
height="0.22916666666666666in"}[**gist**](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image95.jpeg){width="5.208880139982502e-3in"
height="0.27847222222222223in"}

> Softmax classifier

[**min-char-rnn.py**](https://gist.github.com/karpathy/d4dee566867f8291f086)![](media/image97.jpeg){width="8.194444444444444e-2in"
height="0.22916666666666666in"}[**gist**](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image98.jpeg){width="9.859722222222222in"
height="5.561805555555556in"}

> recall:

[**min-char-rnn.py**](https://gist.github.com/karpathy/d4dee566867f8291f086)![](media/image99.jpeg){width="8.194444444444444e-2in"
height="0.22916666666666666in"}[**gist**](https://gist.github.com/karpathy/d4dee566867f8291f086)

![](media/image100.jpeg){width="9.598611111111111in"
height="5.5368055555555555in"}

![](media/image101.jpeg){width="1.675in" height="3.3493055555555555in"}

> y

![](media/image103.jpeg){width="5.208880139982502e-3in"
height="0.36666666666666664in"}

> RNN

![](media/image104.jpeg){width="5.208880139982502e-3in"
height="0.38472222222222224in"}

> x

![](media/image107.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 34 8 Feb 2016

![](media/image108.jpeg){width="9.602777777777778in"
height="5.451388888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 35       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

> ![](media/image109.jpeg){width="9.185416666666667in"
> height="4.864583333333333in"}
>
> train more

![](media/image110.jpeg){width="5.208880139982502e-3in"
height="0.3541666666666667in"}

> train more

![](media/image112.jpeg){width="5.208880139982502e-3in"
height="0.3541666666666667in"}

train more

![](media/image113.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 36 8 Feb 2016

![](media/image114.jpeg){width="9.602777777777778in"
height="5.511111111111111in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 37       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image115.jpeg){width="8.1625in" height="3.970138888888889in"}

![](media/image116.jpeg){width="10.0in" height="1.5284722222222222in"}

> Latex source

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 38 8 Feb 2016

![](media/image117.jpeg){width="9.602777777777778in"
height="5.488888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 39       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image118.jpeg){width="9.602777777777778in"
height="5.554861111111111in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 40       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image119.jpeg){width="9.602777777777778in"
height="5.5159722222222225in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 41       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

> ![](media/image120.jpeg){width="9.259722222222223in"
> height="4.8590277777777775in"}
>
> C code

![](media/image121.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 42 8 Feb 2016

![](media/image122.jpeg){width="9.602777777777778in" height="5.625in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 43       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image123.jpeg){width="9.602777777777778in"
height="5.586111111111111in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 44       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

> ![](media/image124.jpeg){width="8.321527777777778in"
> height="0.6895833333333333in"}

![](media/image125.jpeg){width="9.82013888888889in"
height="1.788888888888889in"}

> *\[Visualizing and Understanding Recurrent Networks, Andrej
> Karpathy\*, Justin Johnson\*, Li Fei-Fei\]*

![](media/image127.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 45 8 Feb 2016

> ![](media/image128.jpeg){width="8.321527777777778in"
> height="0.6895833333333333in"}

![](media/image129.jpeg){width="9.796527777777778in"
height="1.4006944444444445in"}

quote detection cell

![](media/image131.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 46 8 Feb 2016

> ![](media/image132.jpeg){width="8.321527777777778in"
> height="0.6895833333333333in"}

![](media/image133.jpeg){width="9.498611111111112in"
height="2.263888888888889in"}

line length tracking cell

![](media/image135.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 47 8 Feb 2016

> ![](media/image136.jpeg){width="8.321527777777778in"
> height="0.6895833333333333in"}

![](media/image137.jpeg){width="10.0in" height="4.2347222222222225in"}

> if statement cell

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 48 8 Feb 2016

> ![](media/image138.jpeg){width="7.51875in"
> height="0.6256944444444444in"}

![](media/image139.jpeg){width="9.455555555555556in"
height="3.9256944444444444in"}

quote/comment cell

![](media/image140.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 49 8 Feb 2016

> ![](media/image141.jpeg){width="8.321527777777778in"
> height="0.6895833333333333in"}

![](media/image142.jpeg){width="9.657638888888888in"
height="2.0479166666666666in"}

> code depth cell

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 50 8 Feb 2016

> ![](media/image144.jpeg){width="9.313194444444445in"
> height="4.164583333333334in"}
>
> Explain Images with Multimodal Recurrent Neural Networks, Mao et al.
>
> Deep Visual-Semantic Alignments for Generating Image Descriptions,
> Karpathy and Fei-Fei Show and Tell: A Neural Image Caption Generator,
> Vinyals et al.
>
> Long-term Recurrent Convolutional Networks for Visual Recognition and
> Description, Donahue et al. Learning a Recurrent Visual Representation
> for Image Caption Generation, Chen and Zitnick

![](media/image145.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 51 8 Feb 2016

![](media/image146.jpeg){width="5.959722222222222in"
height="0.37222222222222223in"}

![](media/image147.jpeg){width="6.918055555555555in" height="3.50625in"}

> **Convolutional Neural Network**

![](media/image148.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 52 8 Feb 2016

> ![](media/image149.jpeg){width="2.4368055555555554in"
> height="1.3159722222222223in"}

![](media/image150.jpeg){width="2.0902777777777777in"
height="1.4861111111111112in"}

> ![](media/image151.jpeg){width="8.76736111111111in"
> height="5.422916666666667in"}

![](media/image152.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

![](media/image153.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

test image

![](media/image154.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

**X**

![](media/image155.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

![](media/image156.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

x0

\<STA

RT\>

> \<START\>

**Wih**

v

> test image

![](media/image157.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0
>
> **before:**

![](media/image159.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> h = tanh(Wxh \* x + Whh \* h)
>
> ![](media/image160.jpeg){width="0.36319444444444443in"
> height="0.3034722222222222in"} h0
>
> **now:**

![](media/image161.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

h = tanh(Wxh \* x + Whh \* h **+ Wih \* v**)

x0

\<STA

RT\>

\<START\>

![](media/image162.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

![](media/image163.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0

![](media/image164.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> sample!
>
> h0

![](media/image165.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

> x0
>
> \<STA straw
>
> RT\>
>
> \<START\>

![](media/image166.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

![](media/image167.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0 y1

![](media/image168.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> h0 ![](media/image170.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h1

![](media/image171.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

> x0
>
> \<STA straw
>
> RT\>
>
> \<START\>

![](media/image174.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

![](media/image175.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0 y1

![](media/image176.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> sample!
>
> h0 ![](media/image178.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h1

![](media/image179.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

> x0
>
> \<STA straw hat
>
> RT\>
>
> \<START\>

![](media/image182.jpeg){width="8.852777777777778in"
height="5.478472222222222in"}

![](media/image183.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0 y1 y2

![](media/image184.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> h0 ![](media/image187.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h1
> ![](media/image188.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h2

![](media/image189.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

> x0
>
> \<STA straw hat
>
> RT\>
>
> \<START\>

![](media/image194.jpeg){width="3.1958333333333333in"
height="5.208880139982502e-3in"}

> y0 y1 y2

![](media/image196.jpeg){width="5.208880139982502e-3in"
height="0.4597222222222222in"}

> h0 ![](media/image199.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h1
> ![](media/image200.jpeg){width="0.3375in"
> height="0.15208333333333332in"} h2

![](media/image201.jpeg){width="5.208880139982502e-3in"
height="0.5298611111111111in"}

> x0
>
> \<STA straw hat
>
> RT\>
>
> \<START\>
>
> test image

sample \<END\> token =\> finish.

![](media/image206.jpeg){width="9.654861111111112in"
height="5.456944444444445in"}

> Microsoft COCO
>
> *\[Tsung-Yi Lin et al. 2014\]*
> [[mscoco.org]{.underline}](http://mscoco.org)
>
> currently:
>
> \~120K images
>
> \~5 sentences each

![](media/image207.jpeg){width="10.0in" height="2.8291666666666666in"}

![](media/image208.jpeg){width="10.0in" height="5.580555555555556in"}

> ![](media/image209.jpeg){width="7.676388888888889in"
> height="0.7041666666666667in"}
>
> RNN attends spatially to different parts of images while generating
> each word of the sentence:

![](media/image210.jpeg){width="9.854166666666666in"
height="3.810416666666667in"}

*Show Attend and Tell, Xu et al., 2015* ~66~

> ![](media/image211.jpeg){width="10.0in" height="5.625in"}

![](media/image212.jpeg){width="5.208880139982502e-3in"
height="0.2625in"}

> depth

![](media/image259.jpeg){width="2.9402777777777778in"
height="5.208880139982502e-3in"}

> time

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture

> ![](media/image260.jpeg){width="10.0in" height="5.625in"}

![](media/image261.jpeg){width="5.208880139982502e-3in"
height="0.2625in"}

> LSTM:

![](media/image283.jpeg){width="5.208880139982502e-3in"
height="0.2625in"}

> depth

![](media/image309.jpeg){width="2.9402777777777778in"
height="5.208880139982502e-3in"}

> time

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture

> ![](media/image310.jpeg){width="9.491666666666667in"
> height="4.842361111111111in"}

![](media/image311.jpeg){width="10.0in" height="4.586111111111111in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 69 8 Feb 2016

![](media/image313.jpeg){width="8.855555555555556in"
height="0.8333333333333334in"}

*\[Hochreiter et al., 1997\]*

![](media/image314.jpeg){width="2.5368055555555555in"
height="0.3486111111111111in"}

> vector from
>
> below (**x**)

![](media/image315.jpeg){width="5.093055555555556in"
height="2.5881944444444445in"}

<table>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>sigmoid</td>
<td></td>
<td></td>
<td></td>
<td>i</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>x</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>W</td>
<td></td>
<td><blockquote>
<p>h</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>sigmoid</td>
<td></td>
<td></td>
<td></td>
<td>f</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>vector from</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>sigmoid</td>
<td></td>
<td></td>
<td></td>
<td>o</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>before (<strong>h</strong>)</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>tanh</td>
<td></td>
<td></td>
<td></td>
<td>g</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>4n x 2n</td>
<td><blockquote>
<p>4n</p>
</blockquote></td>
<td></td>
<td></td>
<td>4*n</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

![](media/image316.jpeg){width="10.0in" height="3.486111111111111in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 70 8 Feb 2016

![](media/image318.jpeg){width="8.855555555555556in"
height="0.8333333333333334in"}

*\[Hochreiter et al., 1997\]*

![](media/image319.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **cell**

![](media/image322.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **state c**

![](media/image323.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> x

![](media/image326.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> f

![](media/image328.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 71 8 Feb 2016

![](media/image329.jpeg){width="8.855555555555556in"
height="0.8333333333333334in"}

*\[Hochreiter et al., 1997\]*

![](media/image330.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **cell**

![](media/image333.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **state c**

![](media/image334.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> x +

![](media/image337.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> x

![](media/image340.jpeg){width="5.208880139982502e-3in"
height="0.40208333333333335in"}

+-----+--+-----+--+-----+--+
|     |  |     |  |     |  |
+-----+--+-----+--+-----+--+
| > f |  | > i |  | > g |  |
+-----+--+-----+--+-----+--+

![](media/image341.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 72 8 Feb 2016

![](media/image342.jpeg){width="8.855555555555556in"
height="0.8333333333333334in"}

*\[Hochreiter et al., 1997\]*

![](media/image343.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **cell**

![](media/image346.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **state c**

![](media/image347.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> x +

![](media/image350.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

c

![](media/image352.jpeg){width="5.208880139982502e-3in"
height="1.3451388888888889in"}

+---+-----+-----+-----+--------+
|   |     | > x |     | > tanh |
+---+-----+-----+-----+--------+
| f | > i | > g | > o | > x    |
+---+-----+-----+-----+--------+

![](media/image354.jpeg){width="5.208880139982502e-3in"
height="1.3965277777777778in"}

> h

![](media/image357.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 73 8 Feb 2016

+-------------------------------+--------------------+
| Long Short Term Memory (LSTM) | > higher layer, or |
+-------------------------------+--------------------+
| *\[Hochreiter et al., 1997\]* | > prediction       |
+-------------------------------+--------------------+

![](media/image359.jpeg){width="9.679166666666667in"
height="4.924305555555556in"}

> **cell**

![](media/image362.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> **state c**

![](media/image363.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

> x +

![](media/image365.jpeg){width="6.776388888888889in"
height="5.208880139982502e-3in"}

c

![](media/image367.jpeg){width="5.208880139982502e-3in"
height="1.3451388888888889in"}

+---+-----+-----+-----+--------+
|   |     | > x |     | > tanh |
+---+-----+-----+-----+--------+
| f | > i | > g | > o | > x    |
+---+-----+-----+-----+--------+

![](media/image369.jpeg){width="5.208880139982502e-3in"
height="1.3965277777777778in"}

> h

![](media/image372.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 74 8 Feb 2016

> LSTM
>
> **cell**
>
> **state c**

h

![](media/image374.jpeg){width="0.7236111111111111in"
height="5.208880139982502e-3in"}

+--------------+----------------+
| one timestep | > one timestep |
+--------------+----------------+

![](media/image375.jpeg){width="8.186111111111112in"
height="5.208880139982502e-3in"}

+---+----+-----+----+
| x | \+ | > x | \+ |
+---+----+-----+----+

![](media/image382.jpeg){width="8.186111111111112in"
height="5.208880139982502e-3in"}

+-----+-----+------+-----+-----+------+--+
|     | > x | tanh |     | > x | tanh |  |
+-----+-----+------+-----+-----+------+--+
|     |     |      |     |     |      |  |
+-----+-----+------+-----+-----+------+--+
| f   | > g | x    | > f | > g | x    |  |
+-----+-----+------+-----+-----+------+--+
| > i |     |      | > i |     |      |  |
+-----+-----+------+-----+-----+------+--+
|     | > o |      |     |     | > o  |  |
+-----+-----+------+-----+-----+------+--+
| > x |     | > h  | > x |     | > h  |  |
+-----+-----+------+-----+-----+------+--+
|     |     |      |     |     |      |  |
+-----+-----+------+-----+-----+------+--+

![](media/image389.jpeg){width="9.602777777777778in"
height="0.5888888888888889in"}

+-----------------------+-----------------------+-----------------------+
| > Fei-Fei Li & Andrej | > Lecture 10 75       | > 8 Feb 2016          |
| > Karpathy & Justin   |                       |                       |
| > Johnson             |                       |                       |
+-----------------------+-----------------------+-----------------------+
|                       |                       |                       |
+-----------------------+-----------------------+-----------------------+

![](media/image398.jpeg){width="1.5756944444444445in"
height="0.70625in"}

> RNN

state

![](media/image399.jpeg){width="0.9972222222222222in"
height="5.208880139982502e-3in"}

> ![](media/image408.jpeg){width="1.0027777777777778in"
> height="7.63888888888889e-2in"} f
> ![](media/image409.jpeg){width="1.0027777777777778in"
> height="7.63888888888889e-2in"} f
> ![](media/image410.jpeg){width="1.0027777777777778in"
> height="7.63888888888889e-2in"} f

![](media/image411.jpeg){width="0.9972222222222222in"
height="5.208880139982502e-3in"}

+---+-----+-----+
| f | > f | > f |
+---+-----+-----+

![](media/image424.jpeg){width="5.208880139982502e-3in"
height="0.9430555555555555in"}

  ------ ---- ---- ----
  LSTM   \+   \+   \+
  ------ ---- ---- ----

![](media/image434.jpeg){width="5.66875in"
height="5.208880139982502e-3in"}

> (ignoring

![](media/image435.jpeg){width="5.66875in"
height="5.208880139982502e-3in"}

> forget gates)

![](media/image437.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 76 8 Feb 2016

> ![](media/image443.jpeg){width="9.680555555555555in"
> height="4.863888888888889in"}
>
> "PlainNets" vs. ResNets
>
> *ResNet is to PlainNet what LSTM is to RNN*, kind of.

![](media/image444.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 77 8 Feb 2016

> ![](media/image448.jpeg){width="9.686805555555555in"
> height="4.583333333333333in"}
>
> Cute backprop signal video:
> [[http://imgur.com/gallery/vaNahKE]{.underline}](http://imgur.com/gallery/vaNahKE)

![](media/image449.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 78 8 Feb 2016

> ![](media/image450.jpeg){width="8.828472222222222in"
> height="0.6965277777777777in"}

![](media/image451.jpeg){width="9.902777777777779in"
height="3.816666666666667in"}

> if the largest eigenvalue is \> 1, gradient will explode
>
> if the largest eigenvalue is \< 1, gradient will vanish
>
> \[On the difficulty of training Recurrent Neural Networks, Pascanu et
> al., 2013\]

![](media/image452.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 79 8 Feb 2016

> ![](media/image453.jpeg){width="8.828472222222222in"
> height="0.6965277777777777in"}

![](media/image454.jpeg){width="9.902777777777779in"
height="3.816666666666667in"}

> if the largest eigenvalue is \> 1, gradient will explode
>
> if the largest eigenvalue is \< 1, gradient will vanish
>
> can control exploding with gradient clipping
>
> can control vanishing with LSTM
>
> \[On the difficulty of training Recurrent Neural Networks, Pascanu et
> al., 2013\]

![](media/image455.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 80 8 Feb 2016

> ![](media/image456.jpeg){width="9.82986111111111in"
> height="4.784027777777778in"}
>
> \[*LSTM: A Search Space Odyssey*, Greff et al., 2015\]
>
> **GRU** \[*Learning phrase* *representations using rnn encoder-decoder
> for statistical machine translation*, Cho et al. 2014\]

![](media/image457.jpeg){width="10.0in" height="0.5888888888888889in"}

\[*An Empirical Exploration of* *Recurrent Network Architectures,*
Jozefowicz et al., 2015\]

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 81 8 Feb 2016

> ![](media/image458.jpeg){width="9.413194444444445in"
> height="4.245833333333334in"}

-   RNNs allow a lot of flexibility in architecture design

-   Vanilla RNNs are simple but don't work very well

-   Common to use LSTM or GRU: their additive interactions improve
    > gradient flow

-   Backward flow of gradients in RNN can explode or vanish. Exploding
    > is controlled with gradient clipping. Vanishing is controlled with
    > additive interactions (LSTM)

-   Better/simpler architectures are a hot topic of current research

-   Better understanding (both theoretical and empirical) is needed.

![](media/image459.jpeg){width="10.0in" height="0.5888888888888889in"}

Fei-Fei Li & Andrej Karpathy & Justin Johnson Lecture 10 82 8 Feb 2016
